<!DOCTYPE html>
<html>
    <head>
    <title>Readme</title>
    <base href="https://www.ocurrent.org/" />
    <meta charset="UTF-8" />
    <meta
        name="viewport"
        content="width=device-width,initial-scale=1"
    />
    <meta property="og:title" content="Readme" />
<meta property="og:description" content="Readme" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.ocurrent.org/docs/opam-repo-ci/readme/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2024-09-23T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-09-23T00:00:00+00:00" />

    <link
        rel="stylesheet"
        type="text/css"
        href="https://www.ocurrent.org//main.css"
    />
</head>


    <body>
        <div id="menu">
    <h1>
        <a
            href="/"
            title="homepage"
            >OCurrent</a
        >
    </h1>
    <ul>
        
        <li>
            <a
                href="/blog"
                title="blog"
                >Blog</a
            >
        </li>
        
        <li>
            <a
                href="/docs"
                title="docs"
                >Docs</a
            >
        </li>
        
        <li>
            <a
                href="/examples"
                title="examples"
                >Examples</a
            >
        </li>
        
        <li>
            <a
                href="/ocurrent"
                title="api"
                >API</a
            >
        </li>
        
        <li>
            <a
                href="/community"
                title="community"
                >Community</a
            >
        </li>
        
    </ul>
</div>


        <div id="container">
            <main>

<h1>Readme</h1>


<h1 id="opam-repo-ci">opam-repo-ci</h1>
<p>This is an <a href="https://github.com/ocurrent/ocurrent">OCurrent</a> pipeline that tests submissions to <a href="https://github.com/ocaml/opam-repository">opam-repository</a>.</p>
<p>To get set up running the service locally for the first time:</p>
<ul>
<li>Obtain a local copy of the <a href="https://github.com/ocaml/opam-repository">opam-repository</a> Git repo.</li>
<li>Create the directory <code>capnp-secrets</code> in the root of this project (or wherever
you intend to run the service from).</li>
<li>(Possibly) increase the limit on the number of open files, by setting
<code>ulimit</code>.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">mkdir capnp-secrets
</span></span><span class="line"><span class="cl"><span class="nb">ulimit</span> -n <span class="m">102400</span>
</span></span></code></pre></div><p>Then you can run the <code>opam-repo-ci-local</code> command via dune:</p>
<pre tabindex="0"><code>dune exec -- opam-repo-ci-local \
  --confirm harmless \
  --repo REPO-PATH \
  --branch BRANCH-NAME \
  --capnp-address tcp:127.0.0.1:5001 \
  --verbosity info
</code></pre><p>If you would just like to lint your submission locally, you can add the <code>--lint-only</code> flag to the command above.</p>
<p>Here <code>REPO-PATH</code> is the relative or absolute path to your copy of <code>opam-repository</code>, and <code>BRANCH-NAME</code> is the name of the branch containing the changes you want to make, relative to the master branch.</p>
<p>Browse to http://localhost:8080 to see the web UI. You can either set the confirm threshold (at the bottom of the web page) to allow all builds to start, or just click on a yellow box and then on the <code>Start now</code> button to start one step manually.</p>
<p>The analysis step will detect which packages have been changed. Then, for each supported platform it will try to install the package. If that succeeds, it will run the package&rsquo;s tests, and in parallel it will find other packages that depend on this one and test them too.</p>
<h3 id="web-ui">Web UI</h3>
<p>The public web front-end is a separate process. It needs a <code>.cap</code> capability file to connect to the engine. If you have the file for the real service, you can use that. If you&rsquo;re testing the engine locally (as shown above), you can use the <code>./capnp-secrets/opam-repo-ci-admin.cap</code> that it writes out.</p>
<pre tabindex="0"><code>dune exec -- opam-repo-ci-web --backend ./capnp-secrets/opam-repo-ci-admin.cap
</code></pre><p>Then browse to http://localhost:8090/github to see the public UI.</p>
<h2 id="supported-platforms">Supported platforms</h2>
<p>The list of supported platforms is documented in <a href="doc/platforms.md">doc/platforms.md</a>. It can be regenerated by running <code>dune build @doc</code>.</p>


</main>

            <footer>
    <a href="https://tarides.com/">
        <img
            src="/logos/tarides.png"
            alt="Tarides logo"
        />
    </a>
    <div id="license">
        <p>
            OCurrent is developed and maintained by Tarides for use in the OCaml open-source
            community.
        </p>
        <p>
            Â© 2022, the OCurrent authors. Distributed under the
            <a href="https://github.com/ocurrent/ocurrent/blob/master/LICENSE">Apache-2.0</a>
            license.
        </p>
    </div>
</footer>

        </div>
    </body>
</html>
